- content_for :modal_title, 'Comprehensive Health Assessment'

- if @cha.editable_by?(current_user)
  .pull-right
    = link_to 'Edit', polymorphic_path([:edit] + cha_path_generator, id: @cha.id), class: 'btn btn-primary btn-primary__reverse', data: { disable_with: 'Loading...' }

%strong Name:
%span= @client.name
%br
%strong Date Completed:
%span= @cha.completed_at&.to_date || 'in progress'
%br
%strong Case Worker:
%span= @cha.user&.name
%br

- if @cha.reviewed_by
  %strong Supervisor Review:
  %span= @cha.reviewed_by&.name

%p.text-right(style="font-size:smaller;font-style:italic;")
  Only answered questions are shown.

- @cha.answers.each do |section, section_hash|
  %h4= section_hash['title']

  - section_hash['answers'].each do |code, question_answer|
    - question = question_answer['question']
    - answer   = question_answer['answer']
    - next if answer.blank? || (answer.is_a?(Array) && answer.compact.all?(&:blank?))
    .client__assessment-question
      = question
    .client__assessment-answer
      - case answer
      - when Array
        %ul
        - answer.compact.reject(&:blank?).each do |a|
          %li= a
      - else
        - case question
        - when /social security number/i
          = masked_ssn answer
        - when /birthdate/i
          =l answer&.to_date
        - else
          = answer
