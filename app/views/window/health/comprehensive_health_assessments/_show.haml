- content_for :modal_title, 'Comprehensive Health Assessment'

- if @cha.present?
  .d-flex
    .cha__summary
      %strong Name:
      = @client.name
      %br
      %strong Date Completed:
      = @cha.completed_at&.to_date || 'in progress'
      %br
      %strong Case Worker:
      = @cha.user&.name
      %br

      - if @cha.reviewed_by
        %strong Supervisor Review:
        = @cha.reviewed_by&.name
    - if @cha.editable_by?(current_user)
      .ml-auto
        - if ! @cha_locked
          = link_to 'Edit', polymorphic_path([:edit] + cha_path_generator, id: @cha.id), class: 'btn btn-primary btn-primary__reverse', data: { disable_with: 'Loading...', toggle: 'tooltip' }
        - else
          .alert.alert-info
            = _('This CHA has already been reviewed, or a claim was submitted; it is no longer editable')

  %p.text-right(style="font-size:smaller;font-style:italic;")
    Only answered questions are shown.

  - @cha.answers.each do |section, section_hash|
    %h4= section_hash['title']

    - section_hash['answers'].each do |code, question_answer|
      - question = question_answer['question']
      - answer   = question_answer['answer']
      - next if answer.blank? || (answer.is_a?(Array) && answer.compact.all?(&:blank?))
      .client__assessment-question
        = question
      .client__assessment-answer
        - case answer
        - when Array
          %ul
          - answer.compact.reject(&:blank?).each do |a|
            %li= a
        - else
          - case question
          - when /social security number/i
            = masked_ssn answer
          - when /birthdate/i
            =l answer&.to_date
          - else
            = answer
