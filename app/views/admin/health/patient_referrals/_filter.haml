= simple_form_for :filters, url: filters_path, html: {id: 'filter-form'}, method: :get do |f|
  - if @active_patient_referral_group.present?
    = hidden_field_tag :group, @active_patient_referral_group
  .row
    .col-sm-6
      .input-group
        = f.input :search, label: false
        %span.input-group-btn
          %button.btn.btn-default{type: :submit} Search
    .col-sm-6
      .clearfix
        - if show_filters?
          .dropdown.pull-left.margin-right-04
            %button.btn.btn-default{type: 'button', data: {toggle: 'dropdown'}, aria: {haspopup: true, expanded: false}}
              Filter
              %span.caret
            .dropdown-menu{style: 'padding: 10px;'}
              %div{style: 'width: 500px;'}
                .row
                  .col-sm-6
                    = f.input :added_before, as: :date_picker, required: false
                .row
                  .col-sm-6
                    = label_tag 'Claimed?'
                    .radio-button-buttons__container
                      - [['All', :all], ['Claimed', :claimed], ['Unclaimed', :unclaimed]].each do |btn|
                        = f.label :relationship, value: btn.last do
                          = f.radio_button :relationship, btn.last
                          %span= btn.first
                  .col-sm-6
                    .form-group
                      = label_tag :agency_id, 'Claimed by', class: 'control-label'
                      .controls.ui-front
                        = f.hidden_field :agency_id
                        = text_field_tag :agency_id, @filter_agency&.name, class: 'form-control'
                .text-right
                  = link_to filters_path, class: 'btn btn-secondary margin-right-02' do
                    %i.icon-cross
                    Clear Filters
                  %button.btn.btn-action-2{type: 'submit'}
                    %i.icon-filter
                    Filter
        .dropdown.pull-left
          %button.btn.btn-default#sort-partient-referrals{type: 'button', data: {toggle: 'dropdown'}, aria: {haspopup: true, expanded: false}}
            Sort By
            %span.caret
          .dropdown-menu
            .radio-button-list__container
              - [['Referral Date', 'created_at'], ['Last Name', 'last_name']].each do |item|
                = f.label :sort_by, value: item.last do
                  = f.radio_button :sort_by, item.last, onclick: "$(this).parents('form').submit()"
                  %span= item.first

- agency_data = @agencies.map{|a| {label: a.name, value: a.id}}.to_json
- content_for :page_js do
  :javascript
    $(document).ready(function() {
      $(document).on('click', '#filter-form', function(e) {
        e.stopPropagation();
      });
      $('#agency_id').autocomplete({
        source: #{agency_data},
        focus: function(event, ui) {
          $('#agency_id').val(ui.item.label)
          return false
        },
        select: function(event, ui) {
          console.log(ui);
          $('#agency_id').val(ui.item.label)
          $('#filters_agency_id').val(ui.item.value);
          return false
        },
        change: function(event, ui) {
          if(ui.item === null) {
            $('#agency_id').val('')
            $('#filters_agency_id').val('');
          }
        }
      });
    });
