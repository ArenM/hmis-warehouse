= simple_form_for(@careplan, as: :careplan, url: polymorphic_path(careplan_path_generator, client_id: @client.id)) do |f|
  .row.text-small
    .col-sm-offset-4.col-sm-4
      .row
        .col-sm-7.text-right{style: 'padding-right: 0; padding-top: 0.5em;'}
          %strong
            SDH Enroll Date
        .col-sm-5
          = f.input :sdh_enroll_date, label: false, as: :string, input_html: {data: {provide: :datepicker}}
      .row
        .col-sm-7.text-right{style: 'padding-right: 0; padding-top: 0.5em;'}
          %strong
            First meeting with SDH CM
        .col-sm-5
          = f.input :first_meeting_with_case_manager_date, label: false, as: :string, input_html: {data: {provide: :datepicker}}
    .col-sm-4
      Self-Sufficiency Assessment
      .row
        .col-sm-6
          %strong
            Baseline Due
          = f.input :self_sufficiency_baseline_due_date, label: false, as: :string, input_html: {data: {provide: :datepicker}}
          %strong
            Baseline Completed
          = f.input :self_sufficiency_final_due_date, label: false, as: :string, input_html: {data: {provide: :datepicker}}
        .col-sm-6
          %strong
            Final Due
          = f.input :self_sufficiency_baseline_completed_date, label: false, as: :string, input_html: {data: {provide: :datepicker}}
          %strong
            Final Completed
          = f.input :self_sufficiency_final_completed_date, label: false, as: :string, input_html: {data: {provide: :datepicker}}

  .form-actions.text-right
    = f.button :submit, value: 'Update Dates', class: 'btn btn-small'
%h3 Add Goal
= simple_form_for(@goal, as: :goal, url: polymorphic_path(careplan_path_generator + [:goals], id: @careplan.id, client_id: @client.id)) do |f|
  = f.input :type, collection: Health::Goal::Base.available_types, label_method: :type_name, include_blank: false, label: 'Goal Type', input_html: {class: 'select2'}
  = f.input :name, label: 'Goal'
  = f.input :number, label: 'Goal Number', collection: Health::Goal::Base.available_numbers
  .form-actions
    = f.button :submit, value: 'Add Goal'


- if @goals.present?
  .row
    - @goals.each do |goal|
      .col-sm-3
        .goal-tabs
          %span.goal-number.badge
            = goal.number
          %span.goal-name
            = goal.name
  .row
    - @goals.each do |goal|
      - if ['Health::Goal::Clinical', 'Health::Goal::Housing'].include?(goal.type)
        - clinical = goal
        .goal
          %h2.goal-title
            Goal
            = clinical.number
          .goal-form.well
            = simple_form_for(clinical, as: :goal, url: polymorphic_path(careplan_path_generator + [:goal], id: clinical.id, client_id: @client.id)) do |f|
              .row
                .col-sm-6
                  = f.input :name, label: 'Goal'
                  = f.input :associated_dx, label: 'Associated DX'
                  = f.input :barriers
                .col-sm-6
                  %h3.goal__team-plan-title Team Plan
                  = f.input :provider_plan, label: 'Provider'
                  = f.input :case_manager_plan, label: 'SDH Case Manager'
                  = f.input :rn_plan, label: 'RN'
                  = f.input :bh_plan, label: 'BH'

              .form-actions
                = link_to polymorphic_path(careplan_path_generator + [:goal], id: clinical.id, client_id: @client.id), method: :delete, class: 'btn btn-secondary' do 
                  Delete Goal
                = f.button :submit, value: 'Update Goal'
      - elsif ['Health::Goal::Social'].include?(goal.type)
        - social = goal
        .goal
          %h2.goal-title
            Goal
            = social.number
          .goal-form.well
            = simple_form_for(social, as: :goal, url: polymorphic_path(careplan_path_generator + [:goal], id: social.id, client_id: @client.id)) do |f|
              .row
                .col-sm-12
                  = f.input :name, label: 'Goal'
              .row
                .col-sm-12
                  %h3
                    Other Social Needs: Goals
              .row.goal__social
                .col-sm-3
                  = f.input :az_income, label: 'Income/Money Management'
                  = f.input :az_non_cash_benefits, label: 'Non-Cash Benefits'
                  = f.input :az_disabilities, label: 'Disabilities'
                  = f.input :az_food, label: 'Food Insecurity'
                  = f.input :az_employment, label: 'Employment'
                .col-sm-3
                  = f.input :az_training, label: 'Adult Ed/Training'
                  = f.input :az_transportation, label: 'Mobility/Transportation'
                  = f.input :az_life_skills, label: 'Life Skills & Activities of Daily Living (ADLs)'
                  = f.input :az_health_care_coverage, label: 'Health Care Coverage'
                  = f.input :az_physical_health, label: 'Physical Health'
                .col-sm-3
                  = f.input :az_mental_health, label: 'Mental Health'
                  = f.input :az_substance_use, label: 'Substance Use'
                  = f.input :az_criminal_justice, label: 'Criminal Justice'
                  = f.input :az_legal, label: 'Legal, Non-Criminal'
                  = f.input :az_safety, label: 'Safety'
                .col-sm-3
                  = f.input :az_risk, label: 'Risk'
                  = f.input :az_family, label: 'Family & Social Relationships'
                  = f.input :az_community, label: 'Community Involvement'
                  = f.input :az_time_management, label: 'Daily Time Management'
                

              .form-actions
                = link_to polymorphic_path(careplan_path_generator + [:goal], id: social.id, client_id: @client.id), method: :delete, class: 'btn btn-secondary' do 
                  Delete Goal
                = f.button :submit, value: 'Update Goal'
      - elsif ['Health::Goal::SelfManagement'].include?(goal.type)
        - self_management = goal
        .goal
          %h2.goal-title
            Goal
            = self_management.number
          .goal-form.well
            = simple_form_for(self_management, as: :goal, url: polymorphic_path(careplan_path_generator + [:goal], id: self_management.id, client_id: @client.id)) do |f|
              .row
                .col-sm-6
                  = f.input :name, label: 'Goal'
                  = f.input :associated_dx, label: 'Associated DX'
                  = f.input :barriers
                  = f.input :confidence, label: 'Confidence: on a scale of 1 to 10, how confident are you that you can meet your goal?'
                .col-sm-6
                  = f.input :goal_details, as: :text, input_html: {rows: 10}

              .form-actions
                = link_to polymorphic_path(careplan_path_generator + [:goal], id: self_management.id, client_id: @client.id), method: :delete, class: 'btn btn-secondary' do 
                  Delete Goal
                = f.button :submit, value: 'Update Goal'

- else
  %p
    This careplan is lacking goals.